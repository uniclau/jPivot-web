var unc={jPivot:{agregates:{},addAgregate:function(b,a){this.agregates[b]=a},groupers:{},addGrouper:function(b,a){this.groupers[b]=a},formatters:{},addFormatter:function(b,a){this.formatters[b]=a}}};$(function(){$.widget("unc.jPivot",{options:{summary:true,copyright:true,formatter:"default"},_create:function(){this.CollapsedNodes={};this.renderPending=false;this.reset();if(typeof this.options.data!=="undefined"){this.insertRecords(this.options.data)}var a=this;$(this.element).on("click",".collapse_button",function(b){b.preventDefault();a._togleCollapse(this.rel)});$(this.element).on("dragstart",".draggable",function(b){a.pre_post="";a.dragcls="";a.dragdata=$(this).attr("rel");b.originalEvent.dataTransfer.effectAllowed="move";b.originalEvent.dataTransfer.setData("Text",$(this).attr("rel"));$(".pivot").addClass("drag_in_progress")});$(this.element).on("dragleave",".dropable",function(e){console.log("leave");var f=$(this);var b=f.attr("class").match(/\s+(target(X|Y|Z)[\d]+)($|\s)/);var c="."+b[1];var d=a.element;setTimeout(function(){$(c,d).removeClass("dropping_pre");$(c,d).removeClass("dropping_post");a.pre_post="";a.dragcls=""},0);e.stopPropagation();e.preventDefault();return false});$(this.element).on("dragover",".dropable",function(d){console.log("over");var n=$(this);var b=$(this).offset();var h=d.originalEvent.pageX-b.left;var g=d.originalEvent.pageY-b.top;var j=n.attr("class").match(/\s+(target(X|Y|Z)([\d]+))($|\s)/);var q="."+j[1];var f;var c=a.pre_post;var l=a.dragcls;if(j[2]=="Y"){f=g>n.height()/2?"post":"pre"}else{f=h>n.width()/2?"post":"pre"}if(((j[2]=="X")||(j[2]=="Y"))&&(j[3]==0)){f="post"}var p=a.dragdata;var o=$(this).attr("rel");if(a._canMove(p,o,f)){var e=a.element;if((c!=f)||(q!=l)){$(q,e).removeClass("dropping_pre");$(q,e).removeClass("dropping_post");setTimeout(function(){$(q,e).addClass("dropping_"+f);a.pre_post=f;a.dragcls=q},0)}d.originalEvent.dataTransfer.dropEffect="move";d.stopPropagation();d.preventDefault();return false}});$(this.element).on("drop",".dropable",function(c){console.log("drop");var g=$(this);var b=$(this).offset();var e=c.originalEvent.pageX-b.left;var d=c.originalEvent.pageY-b.top;var f=g.attr("class").match(/\s+(target(X|Y|Z)([\d]+))($|\s)/);var l;if(f[2]=="Y"){l=d>g.height()/2?"post":"pre"}else{l=e>g.width()/2?"post":"pre"}if(((f[2]=="X")||(f[2]=="Y"))&&(f[3]==0)){l="post"}var j=c.originalEvent.dataTransfer.getData("Text");var h=$(this).attr("rel");a._moveField(j,h,l);c.preventDefault();return false});$(this.element).on("dragend",".dropable",function(c){var b=a.element;$(".pivot",b).removeClass("drag_in_progress")})},reset:function(){this.fields=[];this.afields=[];this.xfields=[];this.yfields=[];this.zfields=[];this.fieldNames=[];this.fieldLabels=[];this.formatters=[];if((typeof this.options.formatter==="undefined")||(this.options.formatter==null)){this.options.formatter="default"}if(typeof this.options.formatter==="string"){if(typeof unc.jPivot.formatters[this.options.formatter]!=="function"){throw ("Formatter: "+this.options.formatter+" is not defined")}this.defaultFormatter=new unc.jPivot.formatters[this.options.formatter](this.options)}else{if(typeof this.options.formatter==="function"){this.defaultFormatter={format:this.options.formatter}}else{throw ("Invalid formatter")}}if(this.options.formatter==null){throw ("Formatter not defined")}var b=0;var g={};for(var h in this.options.fields){var d=$.extend({agregateType:"distinct",groupType:"distinct",label:h,formatter:null},this.options.fields[h]);if(d.groupType!="none"){if(typeof unc.jPivot.groupers[d.groupType]!=="function"){throw ("Grouper: "+d.groupType+" is not defined")}this.fields.push(new unc.jPivot.groupers[d.groupType](d))}else{this.fields.push(null)}if(d.agregateType!="none"){if(typeof unc.jPivot.agregates[d.agregateType]!=="function"){throw ("Grouper: "+d.agregateType+" is not defined")}this.afields.push(new unc.jPivot.agregates[d.agregateType](d))}else{this.afields.push(null)}if(typeof d.formatter==="string"){if(typeof unc.jPivot.formatters[d.formatter]!=="function"){throw ("Formatter"+d.formatter+" is not defined")}this.formatters.push(new unc.jPivot.formatters[d.formatter](d))}else{if(typeof d.formatter==="function"){this.formatters.push({format:d.formatter})}else{this.formatters.push(null)}}g[h]=b;b++;this.fieldNames.push(h);this.fieldLabels.push(d.label)}for(var c in this.options.xfields){var e=this.options.xfields[c];if(typeof g[e]==="undefined"){throw ("Field "+e+" in xfields not defined")}if(typeof this.fields[g[e]]===null){throw ("Field "+e+"is not groupable ans is ispecified in xfields")}this.xfields.push(g[e])}for(var c in this.options.yfields){var e=this.options.yfields[c];if(typeof g[e]==="undefined"){throw ("Field "+e+" in yfields not defined")}if(typeof this.fields[g[e]]===null){throw ("Field "+e+"is not groupable ans is ispecified in yfields")}this.yfields.push(g[e])}for(var c in this.options.zfields){var e=this.options.zfields[c];if(typeof g[e]==="undefined"){throw ("Field "+e+" in zfields not defined")}if(typeof this.afields[g[e]]===null){throw ("Field "+e+"is not agregatable ans is ispecified in zfields")}this.zfields.push(g[e])}var a=(1<<this.fields.length)-1;this.indexes={};this.indexes_len={};this.indexes[a]={};this.indexes_len[a]=0;this._generate_trees();this._forceRender()},insertRecords:function(c){var d,h;for(d=0;d<c.length;d++){var e=c[d];var g=[];for(h=0;h<this.fields.length;h++){if(this.fields[h]!=null){g.push(this.fields[h].CalculateValue(e))}else{g.push(0)}}for(mask in this.indexes){var j=g.slice(0);for(var b=0;b<this.fields.length;b++){if(((1<<b)&mask)==0){j[b]=0}}var a=this._arr2idx(j);if(typeof this.indexes[mask][a]==="undefined"){this.indexes[mask][a]=[];this.indexes_len[mask]++}for(h=0;h<this.afields.length;h++){if(this.afields[h]!=null){this.indexes[mask][a][h]=this.afields[h].agregate(this.indexes[mask][a][h],e)}}}}this._generate_trees();this._forceRender()},_forceRender:function(){if(this.renderPending){return}this.renderPending=true;var a=this;setTimeout(function(){a.renderPending=false;a._renderHtml()},100)},_arr2idx:function(a){return a.join(",")},_idx2arr:function(c){var a=c.split(",");for(var b in a){a[b]=parseInt(a[b])}return a},_getValues:function(d){var b=0;for(var c=0;c<this.fields.length;c++){if(d[c]==-1){d[c]=0}else{b=b|(1<<c)}}if(typeof this.indexes[b]==="undefined"){this._generate_index(b)}groupidx=this._arr2idx(d);var a=this.indexes[b][groupidx];if((typeof a==="undefined")||(a===null)){a=new Array(this.afields.length)}return a},_generate_index:function(b){var h=null;for(var a in this.indexes){if((b&a)==b){if((h==null)||(this.indexes_len[a]<this.indexes_len[h])){h=a}}}this.indexes[b]={};this.indexes_len[b]=0;for(var d in this.indexes[h]){var e=this._idx2arr(d);for(var a=0;a<this.fields.length;a++){if(((1<<a)&b)==0){e[a]=0}}var c=this._arr2idx(e);if(typeof this.indexes[b][c]==="undefined"){this.indexes[b][c]=[];this.indexes_len[b]++}for(var g=0;g<this.afields.length;g++){if(this.afields[g]!=null){this.indexes[b][c][g]=this.afields[g].agregate(this.indexes[b][c][g],this.indexes[h][d][g])}}}},_generate_trees:function(){var a=(1<<this.fields.length)-1;this.xtree={childs:{}};this.ytree={childs:{}};for(k in this.indexes[a]){var d=this._idx2arr(k);var c=this.xtree;var b;for(b in this.xfields){if(typeof c.childs[d[this.xfields[b]]]==="undefined"){c.childs[d[this.xfields[b]]]={childs:{}}}c=c.childs[d[this.xfields[b]]]}var c=this.ytree;for(b in this.yfields){if(typeof c.childs[d[this.yfields[b]]]==="undefined"){c.childs[d[this.yfields[b]]]={childs:{}}}c=c.childs[d[this.yfields[b]]]}}},_tree2table:function(e,d,q){var l,j;var n=e=="y"?this.yfields.length:this.xfields.length;j=q.length-1;l=q[j].index.length;var f;if(this._isCollapsed(e,q[j].index)){q[j].cells[l]={};q[j].cells[l].spanx=n-l+1;q[j].cells[l].spany=1;f=1}else{var r=q[j].index.slice(0);var b=false;f=0;var p;if(l<n){var o=[];for(var h in d.childs){o.push(h)}var a=e=="y"?this.fields[this.yfields[l]]:this.fields[this.xfields[l]];p=a.DisplayValues(o)}else{p=[]}for(var h=0;h<p.length;h++){if(b){q.push({index:r.slice(0),cells:{}})}q[q.length-1].index.push(p[h]);var g;if(typeof d.childs[p[h]]==="undefined"){g={childs:{},collapsed:false}}else{g=d.childs[p[h]]}f+=this._tree2table(e,g,q);b=true}if(f==0){q[j].cells[l]={};q[j].cells[l].spanx=n-l+1;q[j].cells[l].spany=1;f=1}else{q[j].cells[l]={};q[j].cells[l].spanx=1;q[j].cells[l].spany=f}}return f},_collapseLink:function(b,c){var a='<A href="#" class="collapse_button" rel="'+this._treeNode2str(b,c)+'">';a+=this._isCollapsed(b,c)?"+":"-";a+="</A>";return a},_renderHtml:function(){var a;var n=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;n++;var g=[{index:[],cells:{}}];this._tree2table("x",this.xtree,g);var e=[{index:[],cells:{}}];this._tree2table("y",this.ytree,e);var c="";c+='<table border="0px" cellspacing="0" cellpadding="0" class="pivot">';c+="<tr>";c+='<th colspan="'+(this.xfields.length+1)+'" rowspan="'+(this.yfields.length+2)+'"';var o="";c+=' class="'+o+'"';o="line_bottom_"+n;o="line_right_"+n;c+=">";c+="</th>";a=e.length*this.zfields.length;c+="<th colspan="+a+'"';o="dropable toptitle targetY0 line_top_"+n;o+=this._clsLeftLine(g,e,j,h,this.yfields.length+1);o+=this._clsRightLine(g,e,j,h,this.yfields.length+1);c+=' class="'+o+'"';c+=' rel="Y,0"';c+=">";if(this.yfields.length>0){c+=this._collapseLink("y",[])}c+="All";c+="</th>";c+="</tr>\n";for(var h=1;h<=this.yfields.length;h++){c+="<tr>";for(var j=0;j<e.length;j++){if(e[j].cells[h]){c+='<th draggable="true"';var o="draggable dropable toptitle";o+=this._clsLeftLine(g,e,j,h,e[j].cells[h].spany);o+=this._clsRightLine(g,e,j,h,e[j].cells[h].spany);o+=" targetY"+h;c+=' class="'+o+'"';c+=' rel= "Y,'+h+'"';a=e[j].cells[h].spany*this.zfields.length;c+=' colspan="'+a+'"';c+=' rowspan="'+e[j].cells[h].spanx+'"';c+=">";if(h<this.yfields.length){c+=this._collapseLink("y",e[j].index.slice(0,h))}c+=this.fields[this.yfields[h-1]].getStringValue(e[j].index[h-1]);c+="</th>"}}c+="</tr>\n"}c+="<tr>";for(var j=0;j<e.length;j++){for(var f=0;f<this.zfields.length;f++){c+='<th draggable="true"';var o="draggable dropable ztitle";o+=" line_top_0";o+=" targetZ"+f;o+=" line_top_"+n;if(f==0){o+=this._clsLeftLine(g,e,j,0)}else{o+=" line_left_0"}if(f==this.zfields.length-1){o+=this._clsRightLine(g,e,j,0)}else{o+=" line_right_0"}o+=this._clsGroupX(g,e,j,h);o+=this._clsGroupY(g,e,j,h);c+=' class="'+o+'"';c+=' rel= "Z,'+f+'"';c+=">";c+=this.fieldLabels[this.zfields[f]];c+="</th>"}}c+="<tr>";for(var h=0;h<g.length;h++){for(var j=0;j<=this.xfields.length;j++){if(g[h].cells[j]){c+="<th";c+=g[h].cells[j].spanx>1?' colspan="'+g[h].cells[j].spanx+'"':"";c+=g[h].cells[j].spany>1?' rowspan="'+g[h].cells[j].spany+'"':"";var o="lefttitle dropable";if(j>0){o+=" draggable"}if(j==0){o+=" line_left_"+n}o+=this._clsTopLine(g,e,j,h,g[h].cells[j].spany);o+=this._clsBottomLine(g,e,j,h,g[h].cells[j].spany);o+=" targetX"+j;c+=' class="'+o+'"';c+='"';c+=' rel="X,'+j+'"';if(j>0){c+=' draggable="true"'}c+=">";if(j<this.xfields.length){c+=this._collapseLink("x",g[h].index.slice(0,j))}if(j==0){c+="All"}else{c+=this.fields[this.xfields[j-1]].getStringValue(g[h].index[j-1])}c+="</th>"}}for(var j=0;j<e.length;j++){var p=[];var d;for(d=0;d<this.fields.length;d++){p.push(-1)}for(d=0;d<g[h].index.length;d++){p[this.xfields[d]]=g[h].index[d]}for(d=0;d<e[j].index.length;d++){p[this.yfields[d]]=e[j].index[d]}b=this._getValues(p);for(var f=0;f<this.zfields.length;f++){c+="<td";var o="";o+=this._clsTopLine(g,e,j,h);o+=this._clsBottomLine(g,e,j,h);if(f==0){o+=this._clsLeftLine(g,e,j,h)}else{o+=" line_left_0"}if(f==this.zfields.length-1){o+=this._clsRightLine(g,e,j,h)}else{o+=" line_right_0"}o+=this._clsGroupX(g,e,j,h);o+=this._clsGroupY(g,e,j,h);c+=' class="'+o+'"';c+=">";c+=this._format(this.afields[this.zfields[f]].getValue(b[this.zfields[f]]),this.zfields[f]);c+="</td>"}}c+="</tr>"}if(this.options.summary){c+="<tr>";c+="<td colspan='"+(this.xfields.length+1)+"'";c+=" >";c+="</td>";for(var j=0;j<e.length;j++){var p=[];var d;for(d=0;d<this.fields.length;d++){p.push(-1)}for(d=0;d<e[j].index.length;d++){p[this.yfields[d]]=e[j].index[d]}var b=this._getValues(p);for(var f=0;f<this.zfields.length;f++){c+="<td";var o="summary";o+=" line_top_"+n;o+=" line_bottom_"+n;if(f==0){o+=this._clsLeftLine(g,e,j,h)}else{o+=" line_left_0"}if(f==this.zfields.length-1){o+=this._clsRightLine(g,e,j,h)}else{o+=" line_right_0"}c+=' class="'+o+'"';c+=">";c+=this._format(this.afields[this.zfields[f]].getValue(b[this.zfields[f]]),this.zfields[f]);c+="</td>"}}c+="</tr>"}var l=1+this.xfields.length+e.length*this.zfields.length;c+="<tr><td colspan='"+l;o="";o+=" line_right_"+n;o+=" line_left_"+n;o+=" line_top_"+n;c+=" class='"+o+"'";c+=">";c+="<tr>";for(var d=0;d<l;d++){c+="<td ";o="bordermark";c+=" class='"+o+"'";c+=">";c+="</td>"}c+="</tr>";if(this.options.copyright){c+="<tr><td colspan='"+l+"'";o="copyright";c+=" class='"+o+"'";c+=">";c+="<a href='http://www.jpivot.org'>jPivot</a> by <a href='http://www.uniclau.org'> Uniclau S.L. &copy; 2013 </a> <a href='http://www.gnu.org/licenses/gpl.html'><img src='http://www.gnu.org/graphics/gplv3-88x31.png'></a>";c+="</tr>"}c+="</table>";this.element[0].innerHTML=c},_treeNode2str:function(c,d){var b;var a=[];if(d.length==0){return c}for(b=0;b<this.fields.length;b++){a.push(-1)}for(b=0;b<d.length;b++){if(c=="y"){a[this.yfields[b]]=d[b]}else{a[this.xfields[b]]=d[b]}}return a.join(",")},_isCollapsed:function(b,c){var a=this._treeNode2str(b,c);return(typeof this.CollapsedNodes[a]!=="undefined")},_togleCollapse:function(a){if(typeof this.CollapsedNodes[a]=="undefined"){this.CollapsedNodes[a]=true}else{delete this.CollapsedNodes[a]}this._forceRender()},_canMove:function(g,e,c){var d=g.split(",");d[1]=parseInt(d[1]);var b=e.split(",");b[1]=parseInt(b[1]);if(c=="pre"){b[1]--}if((d[0]=="X")||(d[0]=="Y")){d[1]--}var a=false;if(b[0]=="Z"){if(d[0]=="X"){a=(this.afields[this.xfields[d[1]]]!=null)}else{if(d[0]=="Y"){a=(this.afields[this.yfields[d[1]]]!=null)}else{if(d[0]=="Z"){a=(this.afields[this.zfields[d[1]]]!=null)}}}}else{if(d[0]=="X"){a=(this.fields[this.xfields[d[1]]]!=null)}else{if(d[0]=="Y"){a=(this.fields[this.yfields[d[1]]]!=null)}else{if(d[0]=="Z"){a=(this.fields[this.zfields[d[1]]]!=null)}}}}return a},_moveField:function(g,e,b){var c=g.split(",");c[1]=parseInt(c[1]);var a=e.split(",");a[1]=parseInt(a[1]);if(b=="pre"){a[1]--}var d;if(c[0]=="X"){d=this.xfields[c[1]-1];this.xfields.splice(c[1]-1,1)}else{if(c[0]=="Y"){d=this.yfields[c[1]-1];this.yfields.splice(c[1]-1,1)}else{d=this.zfields[c[1]];this.zfields.splice(c[1],1)}}if(a[0]=="X"){if((c[0]==a[0])&&(c[1]<a[1])){a[1]--}this.xfields.splice(a[1],0,d)}else{if(a[0]=="Y"){if((c[0]==a[0])&&(c[1]<a[1])){a[1]--}this.yfields.splice(a[1],0,d)}else{if((c[0]==a[0])&&(c[1]>a[1])){a[1]++}this.zfields.splice(a[1],0,d)}}this._generate_trees();this._forceRender()},_clsLeftLine:function(g,e,b,f,d){if(typeof d==="undefined"){d=1}var c=" ";if(b>0){var a=0;while((a<this.yfields.length)&&(a<e[b].index.length)&&(a<e[b-1].index.length)&&(e[b].index[a]==e[b-1].index[a])){a++}a=this.yfields.length-a}else{a=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;a++}c+=" line_left_"+a;return c},_clsRightLine:function(f,d,a,e,c){if(typeof c==="undefined"){c=1}var b=" ";if(a+c<d.length){m=0;while((m<this.yfields.length)&&(m<d[a].index.length)&&(m<d[a+c].index.length)&&(d[a].index[m]==d[a+c].index[m])){m++}m=this.yfields.length-m}else{m=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;m++}b+=" line_right_"+m;return b},_clsTopLine:function(f,d,a,e,c){if(typeof c==="undefined"){c=1}var b=" ";if(e>0){m=0;while((m<this.xfields.length)&&(m<f[e].index.length)&&(m<f[e-1].index.length)&&(f[e].index[m]==f[e-1].index[m])){m++}m=this.xfields.length-m}else{m=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;m++}b+=" line_top_"+m;return b},_clsBottomLine:function(f,d,a,e,c){if(typeof c==="undefined"){c=1}var b=" ";if(e+c<f.length){m=0;while((m<this.xfields.length)&&(m<f[e].index.length)&&(m<f[e+c].index.length)&&(f[e].index[m]==f[e+c].index[m])){m++}m=this.xfields.length-m}else{m=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;m++}b+=" line_bottom_"+m;return b},_clsGroupX:function(e,c,a,d){var b=" ";return b},_clsGroupY:function(e,c,a,d){var b=" ";return b},_format:function(b,c){var a=null;if(this.formatters[c]!=null){a=this.formatters[c].format(b,this.fieldNames[c])}if((typeof a==="undefined")||(a==null)){a=this.defaultFormatter.format(b,this.fieldNames[c])}return a}})});function grp_distinct(a){this.values=[];this.names={};this.fieldtype="number";this.field=a.field;if(typeof a.sort=="undefined"){this.sort="ASC"}else{this.sort=a.sort.toUpperCase()}if(typeof a.params!=="undefined"){this.params=a.params}else{this.params=null}if(typeof a.showAll!=="undefined"){this.showAll=a.showAll}else{this.showAll=false}this.CalculateValue=function(d){var b="";var c;if(typeof d[this.field]==="function"){b=d[this.field](this.params)}else{if(typeof d[this.field]==="number"){b=d[this.field].toString()}else{if(typeof d[this.field]==="string"){b=d[this.field];this.fieldtype="string"}}}if(typeof b!=="string"){b=""}if(typeof this.names[b]!=="undefined"){c=this.names[b]}else{c=this.values.push(b)-1;this.names[b]=c}return c};this.getStringValue=function(b){return this.values[b]};this.DisplayValues=function(d){var c;if(this.showAll){c=[];for(i=0;i<this.values.length;i++){c.push(i.toString())}}else{c=d.slice(0)}var b=this;if(this.fieldtype=="string"){c=c.sort(function(f,e){var g=0;if(b.values[f]<b.values[e]){g=-1}if(b.values[f]>b.values[e]){g=1}return g})}else{c=c.sort(function(f,e){var h=parseFloat(b.values[f]);var j=parseFloat(b.values[e]);var g=0;if(h<j){g=-1}if(h>j){g=1}return g})}if(this.sort=="DESC"){c=c.reverse()}return c}}unc.jPivot.addGrouper("distinct",grp_distinct);function agregate_average(a){this.options=$.extend({},a);this.agregate=function(d,c){var e;if((!d)||(d.type!=="agregate_average")){e={type:"agregate_average",sum:0,count:0}}else{e={type:"agregate_average",sum:d.sum,count:d.count}}if(c.type==="agregate_average"){e.sum+=c.sum;e.count+=c.count}else{if(typeof c==="object"){e.count++;if(typeof c[this.options.field]==="number"){e.sum+=c[this.options.field]}else{if(typeof c[this.options.field]==="string"){try{e.sum+=parseInt(c[this.options.field])}catch(f){}}}}}return e};this.getValue=function(b){var d=null;if((b)&&(b.type==="agregate_average")&&(b.count>0)){var c=b.sum/b.count;d=c}return d}}unc.jPivot.addAgregate("average",agregate_average);function agregate_count(a){this.agregate=function(d,c){var e;if((!d)||(d.type!=="agregate_count")){e={type:"agregate_count",count:0}}else{e={type:"agregate_count",count:d.count}}if(c.type==="agregate_count"){e.count+=c.count}else{if(typeof c==="object"){e.count++}}return e};this.getValue=function(b){var c=null;if((b)&&(b.type==="agregate_count")){c=b.count}return c}}unc.jPivot.addAgregate("count",agregate_count);function agregate_distinct(a){this.field=a.field;this.agregate=function(d,c){var e={type:"fa_distinct"};if((!d)||(d.type!=="fa_distinct")){e.repeated=false;if(c.type==="fa_distinct"){e.val=c.val}else{if(typeof c==="object"){e.repeated=false;if((typeof c[this.field]==="number")||(typeof c[this.field]==="string")){e.val=c[this.field]}else{e.val=null}}else{e.val=null}}}else{if(c.type==="fa_distinct"){e.repeated=(d.repeated||c.repeated||(d.val!=c.val));e.val=d.val}else{if(typeof c==="object"){if((typeof c[this.field]==="number")||(typeof c[this.field]==="string")){e.repeated=(d.repeated||(d.val!=c[this.field]));e.val=d.val}else{e.repeated=(d.repeated||(d.val!=null));e.val=null}}else{e.repeated=(d.repeated||(d.val!=null));e.val=null}}}return e};this.getValue=function(b){var c=null;if((b)&&(b.type==="fa_distinct")){if(b.repeated){c="*"}else{c=b.val}}return c}}unc.jPivot.addAgregate("distinct",agregate_distinct);function agregate_sum(a){this.field=a.field;this.agregate=function(d,c){var e;if((!d)||(d.type!=="agregate_sum")){e={type:"agregate_sum",sum:0}}else{e={type:"agregate_sum",sum:d.sum}}if(c.type==="agregate_sum"){e.sum+=c.sum}else{if(typeof c==="object"){if(typeof c[this.field]==="number"){e.sum+=c[this.field]}else{if(typeof c[this.field]==="string"){try{e.sum+=parseInt(c[this.field])}catch(f){}}}}}return e};this.getValue=function(b){var c=null;if((b)&&(b.type==="agregate_sum")){c=b.sum}return c}}unc.jPivot.addAgregate("sum",agregate_sum);function formatter_default(a){this.format=function(c,d){var b="";try{b=c.toString()}catch(e){}return b}}unc.jPivot.addFormatter("default",formatter_default);